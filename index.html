<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LUANA‑Jarvis Chat UI</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Segoe UI', sans-serif; background:#f9f9f9; color:#333; display:flex; flex-direction:column; height:100vh; }

    /* Top Bar */
    .topbar { background:#b00b1d; color:#fff; display:flex; justify-content:space-between; align-items:center; padding:0.8rem 1rem; }
    .topbar nav a { color:#fff; text-decoration:none; margin-right:15px; font-size:14px; }
    .topbar nav a:hover { text-decoration:underline; }
    .topbar-right { font-size:14px; }

    .layout { display:flex; flex:1; overflow:hidden; }

    /* Sidebar */
    .sidebar { width:220px; background:#f1f1f1; padding:1rem; overflow-y:auto; border-right:1px solid #ccc; }
    .sidebar h2 { font-size:16px; margin-bottom:1rem; }
    .sidebar ul { list-style:none; }
    .sidebar li { padding:8px 10px; margin-bottom:6px; background:#fff; border-radius:4px; cursor:pointer; font-size:14px; }
    .sidebar li.active, .sidebar li:hover { background:#d0e7ff; }

    /* Chat Area */
    .chat-area { flex:1; display:flex; flex-direction:column; background:#fff; overflow:hidden; }
    .chat-header { display:flex; justify-content:space-between; align-items:center; padding:1rem 1.5rem; border-bottom:1px solid #e1e1e1; background:#fafafa; }
    .chat-title-left { font-size:18px; font-weight:600; }
    .model-selector { border:1px solid #ccc; padding:6px 12px; border-radius:8px; font-size:14px; background:#fff; cursor:pointer; display:flex; align-items:center; }
    .model-selector .arrow { font-size:10px; margin-left:4px; }

    .chat-body { flex:1; padding:1rem 1.5rem; overflow-y:auto; background:#f7f7f8; display:flex; flex-direction:column; gap:1rem; }
    .message { max-width:80%; display:flex; flex-direction:column; }
    .message.ai { align-self:flex-start; }
    .message.user { align-self:flex-end; text-align:right; }
    .sender { font-size:12px; color:#888; margin-bottom:4px; }
    .bubble { background:#e5e7eb; padding:10px 14px; border-radius:12px; font-size:14px; color:#111; line-height:1.5; white-space:pre-wrap; word-break:break-word; }
    .message.user .bubble { background:#007aff; color:#fff; border-bottom-right-radius:0; }
    .message.ai .bubble { border-bottom-left-radius:0; }

    .chat-input-bar { display:flex; align-items:center; gap:8px; padding:12px 1.5rem; border-top:1px solid #e1e1e1; background:#fff; }
    .chat-input-bar textarea { flex:1; padding:12px; border:1px solid #ccc; border-radius:8px; font-size:14px; resize:none; }
    .icon-button { background:none; border:none; font-size:18px; cursor:pointer; color:#555; }
    .icon-button:hover { color:#000; }
    .send { background:#007aff; border:none; color:#fff; padding:12px 16px; border-radius:8px; font-size:16px; cursor:pointer; }
    .send:hover { background:#005ecb; }
    .image-preview { max-width:200px; border-radius:8px; margin-top:8px; }

    header { display:none; } /* hide duplicate header */
  </style>
</head>
<body>
  <header class="topbar">
    <div class="topbar-left">
      <strong>LUANA</strong>
      <nav>
        <a href="#">ChatGPT</a><a href="#">Black Pearl</a><a href="#">Document Solution</a><a href="#">MBO</a><a href="#">Document</a><a href="#">AX Tool</a><a href="#">AWS</a><a href="#">Manual</a>
      </nav>
    </div>
    <div class="topbar-right">Logout</div>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <h2>Chat Rooms</h2>
      <ul id="roomList"><li class="active">Chat Mặc định</li></ul>
    </aside>

    <main class="chat-area">
      <div class="chat-header">
        <div class="chat-title-left">ChatGPT</div>
        <div class="chat-title-right">
          <div class="model-selector">GPT‑4o <span class="arrow">▼</span></div>
        </div>
      </div>
      <div class="chat-body" id="chat-body"></div>
      <div class="chat-input-bar">
        <button class="icon-button" title="Thêm ảnh" onclick="imageInput.click()">＋</button>
        <textarea id="input" rows="1" placeholder="Nhập tin nhắn..."></textarea>
        <input type="file" id="imageInput" accept="image/*" style="display:none">
        <button class="send" onclick="sendGPT()">➤</button>
      </div>
    </main>
  </div>

  <script>
    const chatBody = document.getElementById("chat-body");
    const inputEl = document.getElementById("input");
    const imageInput = document.getElementById("imageInput");
    let chatId = localStorage.getItem("currentChatId") || createChat();
    function createChat() {
      const id = "chat_" + Date.now();
      localStorage.setItem("currentChatId", id);
      localStorage.setItem(id, JSON.stringify([]));
      renderChat();
      return id;
    }
    function renderChat() {
      chatBody.innerHTML = "";
      const hist = JSON.parse(localStorage.getItem(chatId)) || [];
      hist.forEach(it => {
        if (it.content.startsWith("data:image")) appendImage(it.role, it.content);
        else appendMessage(it.role, it.content);
      });
    }
    function appendMessage(role, content) {
      const msg = document.createElement("div"); msg.className = "message " + (role==="user"? "user":"ai");
      const sender = document.createElement("div"); sender.className="sender"; sender.innerText = role==="user"? "Bạn":"GPT";
      const bubble = document.createElement("div"); bubble.className="bubble"; bubble.innerText=content;
      msg.append(sender,bubble); chatBody.appendChild(msg); chatBody.scrollTop = chatBody.scrollHeight;
    }
    function appendImage(role, data) {
      const msg=document.createElement("div"); msg.className="message "+(role==="user"? "user":"ai");
      const img=document.createElement("img"); img.src=data; img.className="image-preview";
      msg.appendChild(img); chatBody.appendChild(msg); chatBody.scrollTop = chatBody.scrollHeight;
    }
    function save(role, content) {
      const arr = JSON.parse(localStorage.getItem(chatId))||[];
      arr.push({role,content}); localStorage.setItem(chatId, JSON.stringify(arr));
    }
    async function sendGPT() {
      const txt = inputEl.value.trim(), file=imageInput.files[0];
      if (!txt && !file) return;
      if (txt) { appendMessage("user", txt); save("user", txt); }
      inputEl.value=""; imageInput.value="";
      let base64 = null;
      if (file) {
        base64 = await new Promise(r=>{
          const fr=new FileReader(); fr.onload=()=>r(fr.result); fr.readAsDataURL(file);
        });
        appendImage("user", base64); save("user", base64);
      }
      const res = await fetch("https://eoczrwy64u7ppvj.m.pipedream.net", {
        method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({message:txt, image:base64})
      });
      const d = await res.json(), reply = d.data?.ai_response||"❗ Không có phản hồi.";
      appendMessage("ai", reply); save("ai", reply);
    }
    document.addEventListener("paste", async e=>{
      const items = e.clipboardData?.items; if(!items)return;
      for(const it of items) if(it.type.startsWith("image/")){
        const f=it.getAsFile(), b = await new Promise(r=>{
          const fr=new FileReader(); fr.onload=()=>r(fr.result); fr.readAsDataURL(f);
        });
        appendImage("user", b); save("user", b);
        const res = await fetch("https://eoczrwy64u7ppvj.m.pipedream.net", {
          method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({message:"", image:b})
        });
        const d = await res.json(), r = d.data?.ai_response||"❗ Không có phản hồi.";
        appendMessage("ai", r); save("ai", r);
      }
    });
    renderChat();
  </script>
</body>
</html>
